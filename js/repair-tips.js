// js/repair-tips.js
// ฐานข้อมูลแนะนำการซ่อม BEN MOTOR (ชุดใหญ่ระดับพื้น–กลาง)
// ไม่ได้ครอบคลุม "ทุกอาการบนโลก" แต่รวมอาการยอดฮิตที่เจอในอู่จริง

const REPAIR_TIPS = [
  {
    id: "no-start-all",
    title: "สตาร์ตไม่ติดเลย",
    categoryKey: "ไฟฟ้า",
    categoryLabel: "ระบบไฟ / สตาร์ต",
    level: "กลาง",
    vehicleType: ["ได้ทุกประเภท"],
    tags: ["สตาร์ทไม่ติด", "กดสตาร์ตแล้วเงียบ", "บิดกุญแจแล้วไม่ติด"],
    symptom:
      "บิดกุญแจไฟหน้าปัดติด แต่กดสตาร์ตแล้วไม่มีเสียงมอเตอร์ หรือหมุนแล้วเครื่องไม่ติด ทั้งสตาร์ตมือและสตาร์ตเท้า",
    causes: [
      "แบตอ่อน / แบตเสื่อม – แรงดันต่ำกว่า ~12.4V, มอเตอร์สตาร์ตหมุนช้า",
      "ขั้วแบตหลวม / เป็นคราบออกไซด์ ทำให้ไฟไปไม่เต็ม",
      "ฟิวส์หลักขาด หรือสายดินตัวถังหลวม",
      "สวิตช์กุญแจ / สวิตช์เบรก / สวิตช์เซฟตี้ขาตั้งข้างเสีย ทำให้ระบบไม่ยอมสตาร์ต",
      "รีเลย์สตาร์ตเสีย หรือมอเตอร์สตาร์ตเสีย",
      "ไม่มีประกายไฟที่หัวเทียน – คอยล์จุดระเบิด / CDI / ECU มีปัญหา"
    ],
    checks: [
      "วัดแรงดันแบตขณะพักเครื่อง – ถ้าต่ำกว่า 12.4V ให้ชาร์จหรือเปลี่ยนแบต",
      "เช็กขั้วแบต สายกราวด์ตัวถัง ขันให้แน่น ขัดคราบสนิมออก",
      "ตรวจฟิวส์หลักและฟิวส์สตาร์ตด้วยไฟลอง / มัลติมิเตอร์",
      "ลองกำคลัตช์ / ถอนขาตั้งข้าง / บีบเบรกหน้าแล้วกดสตาร์ต เช็กสวิตช์เซฟตี้",
      "ฟังเสียงรีเลย์สตาร์ต – ถ้าดังติ๊กแต่ไม่หมุน ให้เช็กมอเตอร์สตาร์ต",
      "ถอดหัวเทียนออกต่อกับสายหัวเทียน แตะที่ตัวเครื่องแล้วกดสตาร์ต ดูประกายไฟ",
      "ถ้าไฟมีปกติ ให้เช็กซ้ำเรื่องน้ำมันเชื้อเพลิงเข้าเครื่องหรือไม่"
    ],
    fixes: [
      "ชาร์จแบตหรือเปลี่ยนแบตใหม่ หากวัดแล้วแรงดันต่ำหรือ CCA ต่ำ",
      "ทำความสะอาดขั้วแบต สายกราวด์ และจุดต่อต่าง ๆ ให้แน่น",
      "เปลี่ยนฟิวส์ที่ขาดด้วยค่าที่ถูกต้องจากโรงงาน",
      "ซ่อมหรือเปลี่ยนสวิตช์กุญแจ / สวิตช์เบรก / สวิตช์ขาตั้งข้างที่ทำงานผิดปกติ",
      "โอเวอร์ฮอล์หรือเปลี่ยนมอเตอร์สตาร์ต ถ้ากินกระแสสูงแต่ไม่หมุน",
      "ถ้าไม่มีประกายไฟ ให้ไล่ตรวจคอยล์จุดระเบิด CDI หรือ ECU ตามคู่มือแต่ละรุ่น"
    ],
    notes:
      "อาการนี้ควรเริ่มจากไฟเลี้ยงและแบตก่อนเสมอ อย่าพึ่งไปยุ่งระบบน้ำมันหรือเครื่องใน หากลูกค้าจอดนานไม่ค่อยใช้ มักจะเป็นที่แบตเป็นหลัก"
  },
  {
    id: "hard-start-morning",
    title: "ตอนเช้าเครื่องติดยาก แต่พอติดแล้ววิ่งปกติ",
    categoryKey: "เชื้อเพลิง",
    categoryLabel: "น้ำมันเชื้อเพลิง / หัวฉีด / คาร์บู",
    level: "กลาง",
    vehicleType: ["ออโต้/AT", "เกียร์ธรรมดา 4T", "2T"],
    tags: ["ตอนเช้าสตาร์ตยาก", "ต้องบิดคันเร่งช่วย", "ติดแล้วไม่ดับ"],
    symptom:
      "เครื่องตอนเช้าสตาร์ตยาก ต้องกดสตาร์ตนาน บิดคันเร่งช่วย พอเครื่องอุ่นแล้วสตาร์ตครั้งต่อไปติดง่าย",
    causes: [
      "แรงดันน้ำมันเชื้อเพลิงตกตอนจอดทิ้งไว้ – วาล์วน้ำมันในปั๊ม/หัวฉีดรั่วซึม",
      "หัวเทียนเก่า เขม่าจับ ระยะห่างหน้าทองคำไม่ตรงสเปค",
      "ระบบโช้กอัตโนมัติ (ออโต้โช้ก) เสีย ทำให้ตอนเย็นเครื่องได้น้ำมันน้อย",
      "คาร์บูเรเตอร์สกปรก นมหนูตัน ทำให้ส่วนผสมน้ำมัน–อากาศเพี้ยน",
      "กรองอากาศอุดตัน ทำให้สำลักน้ำมัน"
    ],
    checks: [
      "เช็กประวัติเปลี่ยนหัวเทียน – ถ้าเกินระยะให้ถอดมาดูสภาพทันที",
      "ตอนเช้า ลองบิดกุญแจรอ 3–5 วินาที แล้วค่อยกดสตาร์ต ดูว่าดีขึ้นหรือไม่ (ช่วยเช็กแรงดันน้ำมัน)",
      "ตรวจการทำงานของออโต้โช้กตามคู่มือรุ่นนั้น ๆ (วัดค่าความต้านทาน / จ่ายไฟแล้วดูการขยับ)",
      "ถอดกรองอากาศดูความสะอาด ถ้าดำ–อุดตันให้เปลี่ยน",
      "ถอดคาร์บูออกมาล้าง นมหนูเดินเบา–นมหนูหลัก และช่องทางเดินทั้งหมด"
    ],
    fixes: [
      "เปลี่ยนหัวเทียนใหม่ตามเบอร์ที่โรงงานกำหนด และตั้งระยะห่างให้ถูกต้อง",
      "ล้างระบบคาร์บูหรือหัวฉีด พร้อมตรวจแรงดันปั๊มเชื้อเพลิง",
      "เปลี่ยนออโต้โช้กหรือซ่อมสายไฟ/ขั้วต่อให้ทำงานตามสเปค",
      "เปลี่ยนกรองอากาศใหม่ และตรวจซีลกล่องกรองอากาศไม่ให้ดูดฝุ่นตรง ๆ",
      "ถ้าปั๊มติ๊กเริ่มเสียงดังหรือต้องสตาร์ตนาน ควรพิจารณาเปลี่ยนใหม่"
    ],
    notes:
      "อาการนี้ถ้าแก้แล้วควรลองจอดข้ามคืนทดสอบจริง จะเห็นความต่างชัดเจน อย่าดูแค่สตาร์ตซ้ำในเวลาใกล้ ๆ กัน"
  },
  {
    id: "idle-stall",
    title: "ปล่อยคันเร่งแล้วเครื่องดับ / เดินเบาไม่นิ่ง",
    categoryKey: "เชื้อเพลิง",
    categoryLabel: "น้ำมันเชื้อเพลิง / หัวฉีด / คาร์บู",
    level: "ง่าย",
    vehicleType: ["ได้ทุกประเภท"],
    tags: ["ปล่อยคันเร่งแล้วดับ", "รอบวูบ", "เดินเบาสะดุด"],
    symptom:
      "ตอนจอดติดไฟแดง ปล่อยคันเร่งแล้วรอบเครื่องตกจนดับ หรือเดินเบาแล้วรอบขึ้น ๆ ลง ๆ ไม่คงที่",
    causes: [
      "รอบเดินเบาตั้งไว้ต่ำเกินไป",
      "นมหนูเดินเบา/ช่องอากาศคาร์บูตัน",
      "มีลมรั่วเข้าไอดี (ท่อไอดีแตกร้าว, ซีลหาย)",
      "หัวเทียนเริ่มเสื่อมทำให้การจุดระเบิดไม่สม่ำเสมอ",
      "ในรถหัวฉีด – ลิ้นปีกผีเสื้อสกปรก, ISC valve ทำงานผิดปกติ"
    ],
    checks: [
      "ฟังรอบเดินเบาดูว่าต่ำกว่าปกติหรือไม่ แล้วลองปรับสกรูรอบเดินเบาขึ้นเล็กน้อย",
      "ตรวจคาร์บู – ถอดนมหนูเดินเบามาล้างด้วยน้ำยาล้างคาร์บู",
      "ตรวจท่อไอดี/ซีลท่อไอดี ว่ามีรอยแตกร้าวหรือลอยอากาศเข้าหรือไม่",
      "เช็กหัวเทียน – สีหน้าเซรามิก ถ้าเขม่าดำจัด/ขาวจัดควรเปลี่ยน",
      "ในรถหัวฉีด: ถอดลิ้นปีกผีเสื้อออกมาล้าง ทำความสะอาดช่อง ISC"
    ],
    fixes: [
      "ตั้งรอบเดินเบาตามค่าที่คู่มือกำหนด (เช่น 1,500 ±100 rpm ขึ้นกับรุ่น)",
      "ล้างคาร์บูหรือล้างระบบไอดีให้สะอาด โดยเฉพาะช่องเดินเบา",
      "เปลี่ยนหัวเทียนใหม่ถ้าพบว่าเก่าหรือจุดระเบิดไม่สม่ำเสมอ",
      "ซ่อมหรือเปลี่ยนท่อไอดี/ซีลที่รั่ว",
      "ในหัวฉีด: รีเซ็ตกล่อง ECU ตามขั้นตอนหลังล้างลิ้นปีกผีเสื้อ"
    ],
    notes:
      "อาการเดินเบาไม่นิ่งควรรักษาให้เรียบร้อย เพราะเกี่ยวกับความปลอดภัยเวลาเบรกจอดไฟแดง – ถ้าเครื่องดับบ่อย ลูกค้าอาจเสียหลักได้"
  },
  {
    id: "lack-power",
    title: "เร่งแล้วไม่ขึ้น อืด แรงตก",
    categoryKey: "เครื่อง4T",
    categoryLabel: "เครื่องยนต์ 4 จังหวะ / สมรรถนะ",
    level: "กลาง",
    vehicleType: ["ออโต้/AT", "เกียร์ธรรมดา 4T"],
    tags: ["เร่งไม่ขึ้น", "ออกตัวอืด", "ลากรอบไม่ไป"],
    symptom:
      "ออกตัวอืด บิดคันเร่งสุดแต่รถไม่ค่อยไป โดยเฉพาะตอนขึ้นเนินหรือซ้อนสอง",
    causes: [
      "กรองอากาศอุดตัน ทำให้อากาศเข้าไม่พอ",
      "กรองน้ำมัน/หัวฉีด/คาร์บูสกปรก น้ำมันเข้าไม่พอ",
      "คลัทช์ลื่น (ทั้งคลัทช์มือและคลัทช์ออโต้ในรถ AT)",
      "สายคันเร่งหย่อน ทำให้ลิ้นปีกผีเสื้อเปิดไม่สุด",
      "ระยะวาล์วห่างเกินหรือน้อยเกิน ทำให้การระบายไอดี–ไอเสียไม่ดี",
      "แรงอัดเครื่องต่ำจากแหวนลูกสูบหรือกระบอกสูบสึก"
    ],
    checks: [
      "ตรวจกรองอากาศ – ถ้าเป็นโฟมหรือกระดาษดำมากให้เปลี่ยนทันที",
      "เช็กประวัติเปลี่ยนน้ำมันเครื่องและน้ำมันเชื้อเพลิง ว่ามีคราบ/น้ำปนหรือไม่",
      "ลองขึ้นจอด ใช้เกียร์สูง/บรรทุกหนัก แล้วฟังเสียงรอบเครื่องถ้าเครื่องหมุนแรงแต่รถไม่ไป – น่าสงสัยคลัทช์ลื่น",
      "ตรวจสายคันเร่งให้ตึงพอดี เปิด–ปิดลื่นไหล",
      "วัดแรงอัดเครื่องถ้ามีอุปกรณ์ – เทียบค่ากับสเปคโรงงาน",
      "ถอดฝาครอบวาล์ว เช็กระยะวาล์วแล้วตั้งใหม่ให้ตรงสเปค"
    ],
    fixes: [
      "เปลี่ยนกรองอากาศและกรองน้ำมันเชื้อเพลิงตามสภาพ",
      "ล้างหัวฉีด/คาร์บู พร้อมตรวจและปรับส่วนผสมอากาศ–น้ำมัน",
      "โอเวอร์ฮอล์ชุดคลัทช์ เปลี่ยนผ้าคลัทช์–สปริง–ลูกกลิ้งตามสภาพ",
      "ตั้งสายคันเร่งให้ตึงเหมาะสม ไม่ตึง/หย่อนเกินไป",
      "หากแรงอัดต่ำจริง อาจต้องรื้อฝาสูบ เปลี่ยนแหวน/ลูกสูบ/คว้านเสื้อ",
      "ตั้งวาล์วใหม่แล้วลองเทสต์บนถนนจริง"
    ],
    notes:
      "ควรแยกให้ออกว่าเป็นอาการจากเครื่องยนต์เอง หรือจากระบบส่งกำลัง/คลัทช์ เพื่อไม่ให้ถอดเกินที่จำเป็น"
  },
  {
    id: "white-smoke",
    title: "ควันขาวจัด เหม็นน้ำมันเครื่อง",
    categoryKey: "เครื่อง4T",
    categoryLabel: "กินน้ำมันเครื่อง / ควันขาว",
    level: "ยาก",
    vehicleType: ["ออโต้/AT", "เกียร์ธรรมดา 4T"],
    tags: ["ควันขาว", "กินน้ำมันเครื่อง", "ต้องเติมน้ำมันเครื่องบ่อย"],
    symptom:
      "เวลาเร่งคันเร่งมีควันขาวขุ่นออกปลายท่อไอเสีย กลิ่นเหมือนน้ำมันเครื่องไหม้ น้ำมันเครื่องพร่องเร็ว",
    causes: [
      "แหวนลูกสูบสึก ทำให้油เครื่องเล็ดผ่านขึ้นห้องเผาไหม้",
      "กระบอกสูบสึก/เป็นร่อง – แรงอัดตก กินน้ำมันเครื่อง",
      "ซีลก้านวาล์วแข็ง/รั่ว น้ำมันเครื่องไหลลงห้องเผาไหม้",
      "ใช้น้ำมันเครื่องผิดเบอร์ บางเกินในรถที่วิ่งเยอะแล้ว",
      "ท่อหายใจเครื่องอุดตัน ทำให้แรงดันในข้อเหวี่ยงดันน้ำมันเครื่องผิดปกติ"
    ],
    checks: [
      "เช็กระดับน้ำมันเครื่อง – ถ้าลดเร็วผิดปกติให้แจ้งลูกค้าทันที",
      "สังเกตว่าควันออกตอนใดมากที่สุด เช่น ตอนเร่งเครื่องแรง ๆ หรือปล่อยคันเร่งแล้วบิดซ้ำ",
      "ลองทดสอบเปลี่ยนน้ำมันเครื่องเป็นเกรดที่หนืดขึ้นเล็กน้อย แล้วดูพฤติกรรม",
      "วัดแรงอัดเครื่องเปรียบเทียบกับสเปคโรงงาน",
      "ถอดหัวเทียนมาดู – ถ้ามีน้ำมันเครื่องเคลือบสีมันวาว แสดงว่ามีน้ำมันเข้า"
    ],
    fixes: [
      "แจ้งลูกค้าเรื่องค่าใช้จ่ายและแนะนำโอเวอร์ฮอล์เครื่อง (เปลี่ยนแหวน/ลูกสูบ/ซีลต่าง ๆ)",
      "คว้านเสื้อหรือสลิปเสื้อใหม่ ถ้ากระบอกสูบสึกมาก",
      "เปลี่ยนซีลก้านวาล์วทั้งหมด และตรวจระยะวาล์วใหม่",
      "เปลี่ยนน้ำมันเครื่องให้ตรงสเปค และใช้ความหนืดเหมาะสมกับสภาพเครื่อง",
      "ล้างท่อหายใจเครื่อง และตรวจระบบระบายไอข้อเหวี่ยง"
    ],
    notes:
      "ควันขาวจากน้ำมันเครื่องต่างจากควันไอน้ำ – ต้องดมกลิ่นและดูความหนาแน่นให้ดี ก่อนตัดสินใจรื้อเครื่อง"
  },
  {
    id: "blue-smoke-2t",
    title: "รถ 2T ควันน้ำเงิน–ขาวเยอะผิดปกติ",
    categoryKey: "เครื่อง2T",
    categoryLabel: "เครื่องยนต์ 2 จังหวะ / ระบบออโต้ลูป",
    level: "กลาง",
    vehicleType: ["2T"],
    tags: ["2T ควันเยอะ", "กลิ่นน้ำมัน 2T แรง", "กินน้ำมัน 2T"],
    symptom:
      "รถ 2 จังหวะมีควันน้ำเงิน–ขาวออกท่อมากกว่าปกติ กลิ่นน้ำมัน 2T แรง สิ้นเปลืองน้ำมัน 2T",
    causes: [
      "ปั๊มออโต้ลูปจ่ายน้ำมันมากเกินไป",
      "ท่อออโต้ลูปรั่ว/หลุด ทำให้ดูดน้ำมันผิดจังหวะ",
      "ลูกสูบ–แหวน–กระบอกสูบสึก ทำให้ต้องจ่ายน้ำมันมากขึ้นถึงจะไม่ร้อนจัด",
      "ลูกปืนข้อเหวี่ยงหรือตัวซีลข้อเหวี่ยงมีปัญหา ทำให้ดันน้ำมันเข้ามาก"
    ],
    checks: [
      "เช็กอัตราการใช้น้ำมัน 2T ต่อระยะทาง จากการถามลูกค้า",
      "ตรวจปั๊มออโต้ลูปและการตั้งจังหวะตามคู่มือ",
      "ตรวจท่อส่งน้ำมัน 2T ว่ามีรอยรั่ว/อุดตันหรือไม่",
      "วัดแรงอัดเครื่อง ถ้าต่ำมากควรพิจารณาโอเวอร์ฮอล์",
      "ฟังเสียงเครื่องขณะเดินเบาและรอบสูงว่ามีเสียงลูกปืนข้อเหวี่ยงผิดปกติหรือไม่"
    ],
    fixes: [
      "ตั้งปั๊มออโต้ลูปใหม่ตามสเปคโรงงาน",
      "เปลี่ยนท่อส่งน้ำมัน 2T ที่กรอบ/รั่ว",
      "โอเวอร์ฮอล์เครื่อง เปลี่ยนลูกสูบ–แหวน–ซีลข้อเหวี่ยงถ้าจำเป็น",
      "แนะนำลูกค้าใช้คุณภาพน้ำมัน 2T ที่เหมาะสม ไม่ผสมน้ำมันเครื่อง 4T แทน"
    ],
    notes:
      "รถ 2T มีควันเป็นปกติ แต่ถ้าควันแน่นจนบังทางหรือกิน 2T เร็วผิดปกติ ควรตรวจเช็กอย่างละเอียด"
  },
  {
    id: "overheat",
    title: "เครื่องฮีท ร้อนจัด / ไฟเตือนความร้อนขึ้น",
    categoryKey: "เครื่อง4T",
    categoryLabel: "ระบบระบายความร้อน",
    level: "กลาง",
    vehicleType: ["ได้ทุกประเภท"],
    tags: ["เครื่องฮีท", "ไฟรูปเทอร์โมขึ้น", "หม้อน้ำเดือด"],
    symptom:
      "เข็มความร้อนขึ้นสูงมาก ไฟเตือนความร้อนติด หรือมีน้ำเดือดพุ่งจากหม้อน้ำ/ถังพัก",
    causes: [
      "น้ำหล่อเย็นต่ำ/รั่วออกจากระบบ",
      "พัดลมหม้อน้ำไม่ทำงาน หรือสวิตช์พัดลมเสีย",
      "หม้อน้ำอุดตันด้านในหรือครีบหม้อน้ำด้านนอกรับลมได้น้อย",
      "เทอร์โมสตัทค้าง ปิด–เปิดไม่ตรงจังหวะ",
      "ปั๊มน้ำเสีย ใบพัดหลวม/หัก ทำให้การหมุนน้ำไม่ดี"
    ],
    checks: [
      "ตรวจระดับน้ำในหม้อน้ำและถังพัก ถ้าขาดมากให้หาจุดรั่ว",
      "เสียบปลั๊กพัดลมตรง ๆ จากแบต เช็กว่ามอเตอร์พัดลมทำงานหรือไม่",
      "ตรวจฟิวส์–รีเลย์พัดลม และเซ็นเซอร์อุณหภูมิ",
      "ใช้ไฟฉายส่องครีบหม้อน้ำด้านหน้า ดูว่ามีดิน/โคลน/แมลงอุดตันหรือไม่",
      "ถ่ายน้ำหล่อเย็นออกดูสนิม/ตะกรัน ถ้ามากควรล้างระบบ",
      "ถอดเทอร์โมสตัทมาทดสอบในน้ำร้อนว่ามีการเปิด–ปิดตามอุณหภูมิหรือไม่"
    ],
    fixes: [
      "ซ่อม/เปลี่ยนท่อยาง ข้อต่อ และตัวหม้อน้ำที่รั่ว พร้อมเติมน้ำหล่อเย็นใหม่",
      "เปลี่ยนมอเตอร์พัดลมหรือรีเลย์/ฟิวส์ที่เสีย",
      "ล้างหม้อน้ำทั้งระบบ และจัดการสิ่งอุดตันครีบหม้อน้ำด้านนอก",
      "เปลี่ยนเทอร์โมสตัทใหม่ถ้าพบว่าค้าง",
      "เปลี่ยนปั๊มน้ำถ้าใบพัดหลวม/หัก หรือมีเสียงดังผิดปกติ"
    ],
    notes:
      "ห้ามเปิดฝาหม้อน้ำทันทีตอนเครื่องร้อนจัด ควรรอให้เย็นก่อนเสมอ และแจ้งลูกค้าถึงความเสี่ยงฝาสูบโก่งหากใช้งานต่อทั้งที่เครื่องฮีท"
  },
  {
    id: "brake-squeal",
    title: "เบรกหอน เบรกดังเอี๊ยด ๆ",
    categoryKey: "ช่วงล่างเบรก",
    categoryLabel: "เบรก / จาน / ผ้าเบรก",
    level: "ง่าย",
    vehicleType: ["ได้ทุกประเภท"],
    tags: ["เบรกหอน", "เบรกดัง", "จานเบรกมีรอย"],
    symptom:
      "เวลาเบรกจะมีเสียงหอนหรือเอี๊ยด ๆ ออกมาจากล้อหน้า/หลัง โดยเฉพาะตอนเบรกเบา ๆ หรือจวนหยุด",
    causes: [
      "ผ้าเบรกแข็ง/ถูกชนิดเกรดต่ำ ทำให้เกิดเสียง",
      "ฝุ่น/ทราย/หินเล็ก ๆ เข้าไประหว่างผ้าเบรกกับจาน",
      "จานเบรกเป็นรอยเป็นคลื่น หรือคดเล็กน้อย",
      "จุดยึดคาลิเปอร์/น็อตสไลด์ขาดการหล่อลื่น ทำให้สั่น"
    ],
    checks: [
      "ถอดผ้าเบรกออกตรวจสภาพพื้นหน้าและความหนา",
      "ตรวจดูว่ามีเม็ดหิน/ทรายฝังในผ้าเบรกหรือไม่",
      "ตรวจจานเบรก – ใช้มือไล้ดูรอย ถ้ามีคลื่นมากให้วัดระยะหนา",
      "เช็กจุดยึดคาลิเปอร์และสลักสไลด์ ว่าหลวม/ฝืดหรือไม่",
      "ทดลองขับหลังทำความสะอาดหรือเปลี่ยนผ้าเบรกใหม่"
    ],
    fixes: [
      "เปลี่ยนผ้าเบรกใหม่เกรดดีขึ้นที่เหมาะกับการใช้งาน",
      "ทำความสะอาดจานเบรกและคาลิเปอร์ด้วยน้ำยาล้างเบรก",
      "กลึงจานเบรกถ้าความหนายังอยู่ในสเปค แต่มีคลื่นมาก",
      "หล่อลื่นสลักสไลด์คาลิเปอร์ด้วยจาระบีทนความร้อน",
      "ปรับตั้งเบรกดรัมให้หน้าผ้ากัดกับดรัมพอดีถ้าเป็นดรัมเบรก"
    ],
    notes:
      "เสียงเบรกหอนส่วนหนึ่งมาจากคุณสมบัติผ้าเบรก ถ้าลูกค้าเน้นเงียบมาก ๆ ให้เลือกผ้าเบรกเกรดที่เหมาะสมและแจ้งข้อดี–ข้อเสียให้ชัด"
  },
  {
    id: "front-wobble",
    title: "ปล่อยมือแล้วรถส่าย / สั่นที่ความเร็วกลาง ๆ",
    categoryKey: "ช่วงล่างเบรก",
    categoryLabel: "ล้อ / ยาง / ลูกปืนล้อ / ช่วงล่าง",
    level: "กลาง",
    vehicleType: ["ได้ทุกประเภท"],
    tags: ["รถส่าย", "สั่นที่ความเร็ว 60–80", "ล้อหน้าไม่ตรง"],
    symptom:
      "ขับที่ความเร็วประมาณ 50–80 กม./ชม. แล้วรู้สึกหน้ารถสั่นหรือส่าย โดยเฉพาะตอนปล่อยมือแฮนด์",
    causes: [
      "ยางหน้า/หลังสึกไม่เท่ากัน หรือดอกยางบั้ง",
      "ล้อคด หรือน้ำหนักถ่วงล้อไม่สมดุล",
      "ลูกปืนล้อหลวม หรือคอมอเตอร์สึก",
      "โช้กหน้าเสีย น้ำมันรั่ว ทำให้การซับแรงไม่ดี",
      "แฮนด์/คอรถชนหนักมาก่อน โครงเบี้ยวเล็กน้อย"
    ],
    checks: [
      "ตรวจสภาพยางทั้งสองเส้น ดูลายดอกยาง การสึก และปีผลิต",
      "เช็กล้อด้วยการหมุนบนแท่นดูว่ามีการแกว่ง หรือดูจุดถ่วงล้อ",
      "โยกล้อหน้า–หลังดูระยะหลวมของลูกปืนล้อ",
      "ตรวจโช้กหน้าว่ามีน้ำมันรั่วหรือไหม้คราบน้ำมันหรือไม่",
      "สอบถามลูกค้าว่ามีประวัติอุบัติเหตุ/ชนหนักบริเวณหน้ารถหรือไม่"
    ],
    fixes: [
      "เปลี่ยนยางใหม่ถ้ายางสึกบั้งหรือแข็งเกินอายุ",
      "ถ่วงล้อใหม่หรือเปลี่ยนวงล้อถ้าคดมาก",
      "เปลี่ยนลูกปืนล้อหน้า–หลังตามสภาพ",
      "โอเวอร์ฮอล์โช้กหน้า เปลี่ยนน้ำมัน–ซีลโช้ก",
      "ถ้าพบโครงคอเบี้ยวมาก แนะนำอู่ตัวถังหรือศูนย์เช็กโครงเพิ่มเติม"
    ],
    notes:
      "ให้ทดลองขับหลังซ่อมทุกครั้ง และแจ้งลูกค้าว่าการปล่อยมือขับเป็นพฤติกรรมที่ไม่ควรทำ แม้รถจะนิ่งก็ตาม"
  },
  {
    id: "chain-noise",
    title: "โซ่ดัง ก๊อกแก๊ก / ดีดบังโซ่",
    categoryKey: "ส่งกำลัง",
    categoryLabel: "โซ่ / สเตอร์ / ระบบส่งกำลัง",
    level: "ง่าย",
    vehicleType: ["เกียร์ธรรมดา 4T", "2T"],
    tags: ["เสียงโซ่ดัง", "โซ่หย่อน", "ดีดบังโซ่"],
    symptom:
      "เวลาขี่ได้ยินเสียงโซ่ดัง ก๊อกแก๊ก หรือรู้สึกดีดใต้สวิงอาร์ม โดยเฉพาะตอนถอนคันเร่งแล้วปล่อยไหล",
    causes: [
      "โซ่หย่อนเกินสเปค หรือยืดไม่เท่ากันทั้งเส้น",
      "สเตอร์หน้าหลังฟันแหลม/บั้ง",
      "บังโซ่/รางรองโซ่สึก ทำให้โซ่กระแทกโลหะโดยตรง",
      "แนวสวิงอาร์ม–ล้อหลังไม่ตรง (ตั้งโซ่ไม่เท่ากันสองข้าง)"
    ],
    checks: [
      "วัดระยะย้วยของโซ่กลางช่วงระหว่างสเตอร์หน้า–หลัง เทียบกับสเปค",
      "หมุนล้อหลังพร้อมดูฟันสเตอร์ว่ามีคม/บั้งหรือไม่",
      "ตรวจบังโซ่พลาสติก/รางรองโซ่ ว่ามีรอยสึกจนทะลุหรือไม่",
      "เช็กตำแหน่งตั้งโซ่ทั้งสองข้างของสวิงอาร์มให้เท่ากัน",
      "ลองตั้งโซ่แล้วทดสอบขี่จริง ฟังเสียงอีกครั้ง"
    ],
    fixes: [
      "ตั้งโซ่ใหม่ให้อยู่ในระยะที่กำหนด",
      "เปลี่ยนชุดโซ่–สเตอร์พร้อมกันทั้งชุดถ้าสึกมาก",
      "เปลี่ยนรางรองโซ่/บังโซ่ที่สึก",
      "ตั้งแนวล้อหลังให้ตรงกับเฟรมตามจุดมาร์กของสวิงอาร์ม"
    ],
    notes:
      "ควรแนะนำลูกค้าให้หยอดน้ำมันโซ่สม่ำเสมอ และไม่ปรับโซ่ให้ตึงเกินไป เพราะจะดึงลูกปืนและสเตอร์หน้าจนสึกเร็ว"
  },
  {
    id: "auto-cvt-jerk",
    title: "รถออโต้ ออกตัวกระตุก / สะอึก",
    categoryKey: "ออโต้",
    categoryLabel: "CVT / คลัทช์ออโต้ / สายพาน",
    level: "กลาง",
    vehicleType: ["ออโต้/AT"],
    tags: ["ออโต้สะอึก", "ออกตัวสั่น", "สายพานออโต้"],
    symptom:
      "รถ AT ออกตัวแล้วมีอาการสะอึก ๆ หรือสั่นบริเวณท้ายรถ โดยเฉพาะตอนออกตัวช้า ๆ",
    causes: [
      "ผ้าคลัทช์ออโต้เป็นคราบน้ำมันหรือฝุ่นมาก จับ–ปล่อยไม่สม่ำเสมอ",
      "กระทะคลัทช์เป็นรอยไหม้/เป็นคลื่น",
      "ลูกกลิ้งตุ้มน้ำหนัก CVT สึกไม่เท่ากัน หรือฝืดในราง",
      "สายพานแตกลายงา/แข็ง ทำให้การถ่ายกำลังไม่ลื่น"
    ],
    checks: [
      "ถอดฝาครอบ CVT ตรวจสภาพสายพาน รอยแตก/ลายงา",
      "ถอดชุดคลัทช์ออกมาดูผ้าคลัทช์และกระทะคลัทช์",
      "ตรวจลูกกลิ้งในชุดหน้า ว่ามีรอยบั้ง/ติดขัดในรางหรือไม่",
      "ขัดทำความสะอาดฝุ่นผงภายใน CVT",
      "ประกอบกลับแล้วทดลองออกตัวหลาย ๆ ครั้ง"
    ],
    fixes: [
      "ขัดผิวผ้าคลัทช์และกระทะคลัทช์ให้สะอาด ถ้าไหม้หนักควรเปลี่ยนใหม่",
      "เปลี่ยนลูกกลิ้ง CVT ที่สึกและเลือกน้ำหนักให้เหมาะกับสไตล์ลูกค้า",
      "เปลี่ยนสายพานใหม่หากพบว่ามีรอยแตกหรือถึงระยะเปลี่ยน",
      "ทำความสะอาด CXV interior และตรวจซีลกันฝุ่น"
    ],
    notes:
      "อาการกระตุกออกตัวส่วนใหญ่แก้ที่ชุดคลัทช์–กระทะและลูกกลิ้ง แนะนำลูกค้าอย่าบิดคันเร่งค้างแล้วเบรกหน้า–หลังขณะคลานติดไฟแดงบ่อย ๆ เพราะทำให้คลัทช์ไหม้ง่าย"
  }
];

// ---------- Render + filter logic ----------

const searchInput = document.getElementById("repairSearchInput");
const categoryChips = document.getElementById("repairCategoryChips");
const tipsList = document.getElementById("repairTipsList");
const noResultBox = document.getElementById("repairNoResult");
const totalCountEl = document.getElementById("repairTotalCount");

const detailModalEl = document.getElementById("repairTipDetailModal");
const detailModal = new bootstrap.Modal(detailModalEl);

const detailTitleEl = document.getElementById("repairDetailTitle");
const detailMetaEl = document.getElementById("repairDetailMeta");
const detailSymptomEl = document.getElementById("repairDetailSymptom");
const detailCausesEl = document.getElementById("repairDetailCauses");
const detailChecksEl = document.getElementById("repairDetailChecks");
const detailFixesEl = document.getElementById("repairDetailFixes");
const detailNotesEl = document.getElementById("repairDetailNotes");

let currentCategory = "all";
let currentSearch = "";

// normalize string for search (ง่าย ๆ ใช้ toLowerCase)
function normalize(str) {
  return (str || "").toLowerCase();
}

function filterTips() {
  const q = normalize(currentSearch.trim());

  return REPAIR_TIPS.filter((tip) => {
    if (currentCategory !== "all" && tip.categoryKey !== currentCategory) {
      return false;
    }

    if (!q) return true;

    const haystack = normalize(
      [
        tip.title,
        tip.symptom,
        tip.categoryLabel,
        ...(tip.tags || []),
        ...(tip.vehicleType || [])
      ].join(" ")
    );

    return haystack.includes(q);
  });
}

function renderTips() {
  const tips = filterTips();
  totalCountEl.textContent = tips.length.toString();

  tipsList.innerHTML = "";

  if (!tips.length) {
    noResultBox.classList.remove("d-none");
    return;
  }
  noResultBox.classList.add("d-none");

  tips.forEach((tip) => {
    const col = document.createElement("div");
    col.className = "col-12 col-md-6";

    const shortSymptom =
      tip.symptom.length > 90
        ? tip.symptom.slice(0, 90) + "…"
        : tip.symptom;

    col.innerHTML = `
      <div class="bm-card h-100 d-flex flex-column">
        <div class="bm-card-body pb-3">
          <div class="d-flex justify-content-between align-items-start mb-1">
            <h2 class="h6 mb-0">${tip.title}</h2>
            <span class="badge rounded-pill ${
  tip.level === "ง่าย" ? "badge-level-easy" :
  tip.level === "กลาง" ? "badge-level-medium" :
  "badge-level-hard"
}">
ระดับ: ${tip.level}
</span>
          </div>
          <div class="small text-muted mb-1">${tip.categoryLabel}</div>
          <div class="small mb-2">
            ประเภทรถ: ${ (tip.vehicleType || []).join(", ") }
          </div>
          <p class="small mb-2">${shortSymptom}</p>
          <div class="d-flex flex-wrap gap-1">
            ${(tip.tags || [])
              .map(
                (tag) =>
                  `<span class="badge rounded-pill text-bg-light text-muted border">${tag}</span>`
              )
              .join("")}
          </div>
        </div>
        <div class="px-3 pb-3">
          <button
            type="button"
            class="btn btn-sm btn-bm-primary w-100 repair-detail-btn"
            data-tip-id="${tip.id}"
          >
            ดูรายละเอียด
          </button>
        </div>
      </div>
    `;

    tipsList.appendChild(col);
  });

  // bind detail buttons
  tipsList
    .querySelectorAll(".repair-detail-btn")
    .forEach((btn) =>
      btn.addEventListener("click", () =>
        openDetail(btn.getAttribute("data-tip-id"))
      )
    );
}

function openDetail(id) {
  const tip = REPAIR_TIPS.find((t) => t.id === id);
  if (!tip) return;

  detailTitleEl.textContent = tip.title;
  detailMetaEl.textContent = `${tip.categoryLabel} • ระดับงาน: ${tip.level} • ประเภทรถ: ${(tip.vehicleType || []).join(", ")}`;

  detailSymptomEl.textContent = tip.symptom || "";

  // list helpers
  const fillList = (el, items, ordered) => {
    el.innerHTML = "";
    (items || []).forEach((txt) => {
      const li = document.createElement("li");
      li.textContent = txt;
      el.appendChild(li);
    });
  };

  fillList(detailCausesEl, tip.causes || []);
  fillList(detailChecksEl, tip.checks || []);
  fillList(detailFixesEl, tip.fixes || []);

  detailNotesEl.textContent = tip.notes || "";

  detailModal.show();
}

// events
searchInput.addEventListener("input", (e) => {
  currentSearch = e.target.value;
  renderTips();
});

categoryChips.addEventListener("click", (e) => {
  const btn = e.target.closest("button[data-category]");
  if (!btn) return;

  const cat = btn.getAttribute("data-category");
  currentCategory = cat;

  categoryChips
    .querySelectorAll("button[data-category]")
    .forEach((b) => b.classList.remove("active"));
  btn.classList.add("active");

  renderTips();
});

// initial render
renderTips();