<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="utf-8" />
    <title>BEN MOTOR POS – App</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
    />

    <link rel="stylesheet" href="./css/style.css" />
  </head>
  <body class="bm-app theme-light">
    <div class="bm-layout">
      <nav class="bm-sidebar d-none d-md-flex flex-column">
        <div class="bm-sidebar-header">
          <div class="bm-logo">
            <div class="bm-logo-icon">
              <i class="bi bi-wrench-adjustable"></i>
            </div>
            <div class="bm-logo-text">
              <span class="bm-logo-title">BEN MOTOR</span>
              <span class="bm-logo-subtitle">POS</span>
            </div>
          </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/eruda"></script>
        <script>
          eruda.init();
        </script>
        
        <div class="bm-sidebar-nav flex-grow-1">
          <button
            type="button"
            class="bm-nav-item active"
            data-section-target="dashboard"
          >
            <i class="bi bi-speedometer2"></i>
            <span>แดชบอร์ด</span>
          </button>
          <button
            type="button"
            class="bm-nav-item"
            data-section-target="pos"
          >
            <i class="bi bi-journals"></i>
            <span>เปิดบิล / ใบรับรถ</span>
          </button>
          <button
            type="button"
            class="bm-nav-item"
            data-section-target="jobs"
          >
            <i class="bi bi-list-check"></i>
            <span>งานซ่อมทั้งหมด</span>
          </button>
          <button
            type="button"
            class="bm-nav-item"
            data-section-target="vehicles"
          >
            <i class="bi bi-motorbike"></i>
            <span>รถซื้อ–ขาย</span>
          </button>
          <button
            type="button"
            class="bm-nav-item"
            data-section-target="stock"
          >
            <i class="bi bi-box-seam"></i>
            <span>สต็อก & อะไหล่</span>
          </button>
          <button
            type="button"
            class="bm-nav-item"
            data-section-target="reports"
          >
            <i class="bi bi-bar-chart"></i>
            <span>รายงาน / สถิติ</span>
          </button>
        </div>
        
        <div class="bm-sidebar-footer">
          <button type="button" class="bm-nav-item" id="sidebarLogoutBtn">
            <i class="bi bi-box-arrow-right"></i>
            <span>ออกจากระบบ</span>
          </button>
        </div>
      </nav>
      <div class="bm-main-content">
        <header class="bm-top-bar">
          <div class="d-flex align-items-center">
            <div class="bm-logo-mobile d-md-none me-3">
              <i class="bi bi-wrench-adjustable"></i>
            </div>
            <div class="bm-title-area">
              <div class="bm-title-main" id="appTitleMain">แดชบอร์ด BEN MOTOR</div>
              <div class="bm-title-sub text-muted small d-none d-md-block" id="appTitleSub">ภาพรวมวันนี้จากข้อมูลในระบบ</div>
            </div>
          </div>

          <div class="d-flex align-items-center">
            <div class="bm-top-time small me-3 d-none d-lg-block">
              <i class="bi bi-calendar-check me-1"></i>
              <span id="currentDateTime">1 มกราคม 2567, 00:00:00</span>
            </div>

            <div class="dropdown">
              <button
                class="btn btn-sm btn-light dropdown-toggle"
                type="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                <i class="bi bi-person-circle me-1"></i>
                <span id="currentUserEmail" class="small">user@benmotor.com</span>
              </button>
              <ul class="dropdown-menu dropdown-menu-end">
                <li>
                  <button class="dropdown-item" type="button" data-section-target="settings">
                    <i class="bi bi-gear-wide-connected me-2"></i>ตั้งค่า
                  </button>
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li>
                  <button class="dropdown-item text-danger" type="button" id="userLogoutBtn">
                    <i class="bi bi-box-arrow-right me-2"></i>ออกจากระบบ
                  </button>
                </li>
              </ul>
            </div>
          </div>
        </header>
        <main class="bm-section-area">
          
          <section
            class="bm-section active"
            data-section="dashboard"
          >
            <h2 class="d-none">แดชบอร์ด</h2>
            <div class="row g-3 mb-4">
              <div class="col-6 col-lg-3">
                <div class="bm-stat-card bg-primary-subtle text-primary">
                  <div class="bm-stat-label">ยอดรวมวันนี้</div>
                  <div id="dashTotalToday" class="bm-stat-value">0 บาท</div>
                  <div class="bm-stat-desc">รวมค่าแรง + อะไหล่ + รถซื้อ–ขาย</div>
                </div>
              </div>
              <div class="col-6 col-lg-3">
                <div class="bm-stat-card bg-success-subtle text-success">
                  <div class="bm-stat-label">งานเสร็จวันนี้</div>
                  <div id="dashJobsDoneToday" class="bm-stat-value">0 งาน</div>
                  <div class="bm-stat-desc">พร้อมส่งมอบและปิดบิล</div>
                </div>
              </div>
              <div class="col-6 col-lg-3">
                <div class="bm-stat-card bg-warning-subtle text-warning">
                  <div class="bm-stat-label">รถค้างในอู่</div>
                  <div id="dashJobsInProgress" class="bm-stat-value">0 คัน</div>
                  <div class="bm-stat-desc">รวมสถานะรออะไหล่และกำลังซ่อม</div>
                </div>
              </div>
              <div class="col-6 col-lg-3">
                <div class="bm-stat-card bg-info-subtle text-info">
                  <div class="bm-stat-label">สต็อกใกล้หมด</div>
                  <div id="dashLowStockCount" class="bm-stat-value">0 ชิ้น</div>
                  <div class="bm-stat-desc">จำนวนรายการอะไหล่ที่ต้องสั่งซื้อ</div>
                </div>
              </div>
            </div>
            
            <div class="row g-4">
              <div class="col-lg-6">
                <div class="bm-card">
                  <div class="bm-card-header">
                    <div class="bm-card-title">
                      <i class="bi bi-list-check me-2"></i>
                      งานซ่อมด่วนที่ต้องเร่ง
                    </div>
                  </div>
                  <div class="bm-card-body p-0">
                    <div class="bm-list-group" id="dashUrgentJobsList">
                      <div class="p-3 text-muted text-center">ไม่มีงานด่วนในช่วงนี้</div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-lg-6">
                <div class="bm-card">
                  <div class="bm-card-header">
                    <div class="bm-card-title">
                      <i class="bi bi-motorbike me-2"></i>
                      รถซื้อ–ขายค้างสต็อก 5 รายการล่าสุด
                    </div>
                  </div>
                  <div class="bm-card-body p-0">
                    <div class="bm-list-group" id="dashVehiclesStockList">
                      <div class="p-3 text-muted text-center">ไม่มีรถค้างสต็อกใหม่</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>
          <section
            class="bm-section"
            data-section="pos"
          >
            <h2 class="d-none">เปิดบิล / ใบรับรถ</h2>
            <form id="posForm" class="row g-4 mb-4">
              <div class="col-lg-12">
                <div class="bm-card">
                  <div class="bm-card-header">
                    <div class="bm-card-title">ข้อมูลลูกค้าและยานพาหนะ</div>
                  </div>
                  <div class="bm-card-body row g-3">
                    <div class="col-12 col-md-6">
                      <label class="form-label small">ชื่อลูกค้า (หรือชื่อผู้รับผิดชอบ)</label>
                      <input
                        type="text"
                        class="form-control"
                        id="posCustomerName"
                        placeholder="เช่น สมชาย ใจดี"
                        required
                      />
                    </div>
                    <div class="col-12 col-md-6">
                      <label class="form-label small">เบอร์โทรศัพท์</label>
                      <input
                        type="tel"
                        class="form-control"
                        id="posCustomerPhone"
                        placeholder="เช่น 08x-xxxxxxx"
                        required
                      />
                    </div>
                    <div class="col-12 col-md-6">
                      <label class="form-label small">รุ่นรถ / ยี่ห้อ</label>
                      <input
                        type="text"
                        class="form-control"
                        id="posVehicleModel"
                        placeholder="เช่น Wave 110i, Kaze ZX"
                        required
                      />
                    </div>
                    <div class="col-6 col-md-3">
                      <label class="form-label small">ทะเบียน</label>
                      <input
                        type="text"
                        class="form-control"
                        id="posVehiclePlate"
                        placeholder="เช่น กข1234"
                      />
                    </div>
                    <div class="col-6 col-md-3">
                      <label class="form-label small">เลขไมล์</label>
                      <input
                        type="number"
                        class="form-control"
                        id="posVehicleMileage"
                        placeholder="เช่น 15000"
                      />
                    </div>
                    <div class="col-12">
                      <label class="form-label small">ปัญหาที่แจ้ง/รายการซ่อมโดยย่อ</label>
                      <textarea
                        class="form-control"
                        id="posJobDescription"
                        rows="2"
                        placeholder="เช่น เปลี่ยนถ่ายน้ำมันเครื่อง, เช็คช่วงล่างมีเสียงดัง, ล้างคาบูเรเตอร์"
                        required
                      ></textarea>
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-lg-12">
                <div class="bm-card">
                  <div class="bm-card-header d-flex justify-content-between align-items-center">
                    <div class="bm-card-title">รายการ ค่าแรง/อะไหล่</div>
                    <div class="btn-group btn-group-sm">
                      <button type="button" class="btn btn-outline-primary" id="addLaborItemBtn">
                        <i class="bi bi-tools me-1"></i>เพิ่มค่าแรง
                      </button>
                      <button type="button" class="btn btn-outline-success" id="addPartItemBtn">
                        <i class="bi bi-boxes me-1"></i>เพิ่มอะไหล่
                      </button>
                    </div>
                  </div>
                  <div class="bm-card-body p-0 table-responsive">
                    <table class="table mb-0 align-middle">
                      <thead>
                        <tr>
                          <th style="width: 10%">ประเภท</th>
                          <th style="width: 40%">รายละเอียด</th>
                          <th style="width: 10%" class="text-end">จำนวน</th>
                          <th style="width: 20%" class="text-end">ราคา/หน่วย</th>
                          <th style="width: 15%" class="text-end">ราคารวม</th>
                          <th style="width: 5%"></th>
                        </tr>
                      </thead>
                      <tbody id="posItemsBody">
                        </tbody>
                    </table>
                  </div>
                </div>
              </div>
              
              <div class="col-lg-6 order-lg-2">
                <div class="bm-card">
                  <div class="bm-card-header"><div class="bm-card-title">สถานะและสรุปการชำระ</div></div>
                  <div class="bm-card-body">
                    <div class="mb-3">
                      <label class="form-label small">สถานะเริ่มต้นของงาน</label>
                      <select id="posJobStatus" class="form-select">
                        <option value="pending">รอการตรวจเช็ค (ใบรับรถ)</option>
                        <option value="in-progress" selected>กำลังดำเนินการ/กำลังซ่อม</option>
                        <option value="awaiting-part">รออะไหล่</option>
                        <option value="ready">ซ่อมเสร็จ / พร้อมส่งมอบ</option>
                      </select>
                    </div>
                    <div class="mb-3">
                      <label class="form-label small">ส่วนลด (บาท)</label>
                      <input type="number" class="form-control text-end" id="posDiscountInput" value="0" min="0" />
                    </div>
                    <div class="mb-3">
                      <label class="form-label small">ลูกค้าชำระ (บาท)</label>
                      <input type="number" class="form-control text-end" id="posCustomerPaidInput" value="0" min="0" />
                    </div>
                    
                    <div class="d-flex justify-content-between fw-semibold text-success fs-5">
                      <div>เงินทอน:</div>
                      <div id="posChangeText">0 บาท</div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-lg-6 order-lg-1">
                <div class="bm-card">
                  <div class="bm-card-header"><div class="bm-card-title">สรุปค่าใช้จ่าย</div></div>
                  <div class="bm-card-body">
                    <div class="d-flex justify-content-between mb-2">
                      <div>ยอดรวมค่าแรง:</div>
                      <div id="posSubtotalLabor">0 บาท</div>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                      <div>ยอดรวมอะไหล่:</div>
                      <div id="posSubtotalPart">0 บาท</div>
                    </div>
                    <div class="d-flex justify-content-between fw-semibold mb-3">
                      <div>รวมก่อนส่วนลด:</div>
                      <div id="posGrandSubtotal">0 บาท</div>
                    </div>
                    <div class="d-flex justify-content-between text-danger mb-3">
                      <div>ส่วนลด:</div>
                      <div id="posDiscountText">0 บาท</div>
                    </div>
                    <div class="d-flex justify-content-between fw-bold fs-4 border-top pt-2">
                      <div>รวมสุทธิ (Total):</div>
                      <div id="posGrandTotal" class="text-primary">0 บาท</div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-12 order-lg-3">
                <div class="d-flex justify-content-end gap-2">
                  <button type="button" class="btn btn-outline-secondary" id="posPrintBtn">
                    <i class="bi bi-printer me-1"></i>พิมพ์
                  </button>
                  <button type="button" class="btn btn-primary" id="posSaveBtn">
                    <i class="bi bi-save me-1"></i>บันทึกบิล / เปิดงานใหม่
                  </button>
                </div>
              </div>
            </form>
            </section>
          <section
            class="bm-section"
            data-section="jobs"
          >
            <h2 class="d-none">งานซ่อมทั้งหมด</h2>
            <div class="mb-4">
              <form id="jobsFilterForm" class="row g-2">
                <div class="col-12 col-lg-3">
                  <label class="form-label small">ค้นหา (ทะเบียน/ลูกค้า)</label>
                  <input
                    type="text"
                    id="jobsSearchInput"
                    class="form-control"
                    placeholder="เช่น กก1234 หรือ คุณสมชาย"
                  />
                </div>
                <div class="col-6 col-lg-3">
                  <label class="form-label small">สถานะ</label>
                  <select id="jobsStatusFilter" class="form-select">
                    <option value="all">ทุกสถานะ</option>
                    <option value="pending">รอตรวจเช็ค</option>
                    <option value="in-progress">กำลังดำเนินการ</option>
                    <option value="awaiting-part">รออะไหล่</option>
                    <option value="ready">พร้อมส่งมอบ</option>
                    <option value="done">ปิดบิลแล้ว</option>
                    <option value="canceled">ยกเลิก</option>
                  </select>
                </div>
                <div class="col-6 col-lg-3">
                  <label class="form-label small">ช่วงเวลาที่เปิดบิล</label>
                  <select id="jobsDateRange" class="form-select">
                    <option value="all">ทั้งหมด</option>
                    <option value="today">วันนี้</option>
                    <option value="yesterday">เมื่อวาน</option>
                    <option value="this-week">สัปดาห์นี้</option>
                    <option value="this-month" selected>เดือนนี้</option>
                    <option value="last-month">เดือนที่แล้ว</option>
                  </select>
                </div>
                <div class="col-12 col-lg-3 d-flex align-items-end">
                  <button type="button" class="btn btn-secondary w-100" id="jobsReloadBtn">
                    <i class="bi bi-arrow-clockwise me-1"></i>
                    โหลดข้อมูล
                  </button>
                </div>
              </form>
            </div>

            <div class="bm-card">
              <div class="bm-card-header">
                <div class="bm-card-title">
                  รายการงานซ่อม (<span id="jobsCountText">0</span> งาน)
                </div>
              </div>
              <div class="bm-card-body p-0 table-responsive">
                <table class="table align-middle mb-0" id="jobsTable">
                  <thead>
                    <tr>
                      <th style="width: 25%">ลูกค้า/ทะเบียน</th>
                      <th style="width: 30%">อาการที่แจ้ง</th>
                      <th style="width: 15%">สถานะ</th>
                      <th style="width: 15%" class="text-end">ยอดรวม</th>
                      <th style="width: 15%"></th>
                    </tr>
                  </thead>
                  <tbody id="jobsTableBody">
                    </tbody>
                </table>
              </div>
              <div class="p-3 text-muted text-center d-none" id="jobsTableEmpty">
                ไม่พบรายการงานซ่อมที่ตรงกับเงื่อนไขที่เลือก
              </div>
            </div>
          </section>
          <section
            class="bm-section"
            data-section="vehicles"
          >
            <h2 class="d-none">รถซื้อ–ขาย BEN MOTOR</h2>
            <div class="mb-4 d-flex justify-content-end">
              <button
                type="button"
                class="btn btn-primary"
                data-bs-toggle="modal"
                data-bs-target="#vehicleBuyModal"
              >
                <i class="bi bi-plus-circle me-1"></i>
                รับซื้อรถใหม่เข้าระบบ
              </button>
            </div>
            
            <ul class="nav nav-tabs mb-4" role="tablist">
              <li class="nav-item" role="presentation">
                <button
                  class="nav-link active"
                  id="vehicles-stock-tab"
                  data-bs-toggle="tab"
                  data-bs-target="#vehicles-stock-pane"
                  type="button"
                  role="tab"
                >
                  <i class="bi bi-box-seam me-1"></i>
                  ค้างสต็อก (<span id="vehiclesStockCount">0</span> คัน)
                </button>
              </li>
              <li class="nav-item" role="presentation">
                <button
                  class="nav-link"
                  id="vehicles-sold-tab"
                  data-bs-toggle="tab"
                  data-bs-target="#vehicles-sold-pane"
                  type="button"
                  role="tab"
                >
                  <i class="bi bi-currency-dollar me-1"></i>
                  ขายแล้ว (<span id="vehiclesSoldCount">0</span> คัน)
                </button>
              </li>
            </ul>

            <div class="tab-content">
              <div
                class="tab-pane fade show active"
                id="vehicles-stock-pane"
                role="tabpanel"
              >
                <div class="table-responsive">
                  <table class="table align-middle" id="vehiclesStockTable">
                    <thead>
                      <tr>
                        <th style="width: 30%">รุ่น / ทะเบียน</th>
                        <th style="width: 15%">สี</th>
                        <th style="width: 15%" class="text-end">ราคาซื้อเข้า</th>
                        <th style="width: 15%" class="text-end">ค่าใช้จ่ายอื่น</th>
                        <th style="width: 15%" class="text-center">วันที่รับซื้อ</th>
                        <th style="width: 10%"></th>
                      </tr>
                    </thead>
                    <tbody id="vehiclesStockBody">
                      </tbody>
                  </table>
                </div>
                <div class="p-3 text-muted text-center d-none" id="vehiclesStockEmpty">
                  ยังไม่มีรถค้างสต็อก
                </div>
              </div>

              <div
                class="tab-pane fade"
                id="vehicles-sold-pane"
                role="tabpanel"
              >
                <div class="table-responsive">
                  <table class="table align-middle" id="vehiclesSoldTable">
                    <thead>
                      <tr>
                        <th style="width: 25%">รุ่น / ทะเบียน</th>
                        <th style="width: 15%" class="text-end">ราคาซื้อเข้า</th>
                        <th style="width: 15%" class="text-end">ค่าใช้จ่ายอื่น</th>
                        <th style="width: 15%" class="text-end">ราคาขายออก</th>
                        <th style="width: 15%" class="text-end">กำไร/ขาดทุน</th>
                        <th style="width: 15%" class="text-center">วันที่ขาย</th>
                      </tr>
                    </thead>
                    <tbody id="vehiclesSoldBody">
                      </tbody>
                  </table>
                </div>
                <div class="p-3 text-muted text-center d-none" id="vehiclesSoldEmpty">
                  ยังไม่มีรถที่ขายแล้ว
                </div>
              </div>
            </div>
          </section>
          <section
            class="bm-section"
            data-section="stock"
          >
            <h2 class="d-none">สต็อก & อะไหล่</h2>
            <div class="mb-4 d-flex justify-content-between align-items-center">
              <button
                type="button"
                class="btn btn-success"
                id="stockAddNewBtn"
              >
                <i class="bi bi-plus-circle me-1"></i>
                เพิ่มอะไหล่ใหม่
              </button>
              <button
                type="button"
                class="btn btn-secondary"
                id="stockReloadBtn"
              >
                <i class="bi bi-arrow-clockwise me-1"></i>
                โหลดข้อมูล
              </button>
            </div>
            
            <div class="bm-card mb-4">
              <div class="bm-card-body row g-2">
                <div class="col-12 col-lg-4">
                  <label class="form-label small">ค้นหา (ชื่อ/รหัส)</label>
                  <input
                    type="text"
                    id="stockSearchInput"
                    class="form-control"
                    placeholder="เช่น หัวเทียน, กรองอากาศ"
                  />
                </div>
                <div class="col-6 col-lg-3">
                  <label class="form-label small">หมวดหมู่</label>
                  <select id="stockCategoryFilter" class="form-select">
                    <option value="all">ทุกหมวดหมู่</option>
                    <option value="engine">เครื่องยนต์</option>
                    <option value="chassis">ตัวถัง/ช่วงล่าง</option>
                    <option value="electric">ไฟฟ้า</option>
                    <option value="chemical">เคมีภัณฑ์</option>
                    <option value="tool">เครื่องมือ</option>
                    <option value="other">อื่น ๆ</option>
                  </select>
                </div>
                <div class="col-6 col-lg-5 d-flex align-items-end">
                  <div class="form-check form-switch mb-0">
                    <input class="form-check-input" type="checkbox" role="switch" id="stockLowOnlyToggle" />
                    <label class="form-check-label" for="stockLowOnlyToggle"
                      >แสดงเฉพาะรายการที่ใกล้หมด (Low Stock)</label
                    >
                  </div>
                </div>
              </div>
            </div>

            <div class="bm-card">
              <div class="bm-card-header">
                <div class="bm-card-title">
                  รายการอะไหล่ทั้งหมด
                </div>
              </div>
              <div class="bm-card-body p-0 table-responsive">
                <table class="table align-middle mb-0" id="stockTable">
                  <thead>
                    <tr>
                      <th style="width: 20%">ชื่ออะไหล่</th>
                      <th style="width: 15%">SKU / รหัส</th>
                      <th style="width: 15%">หมวด</th>
                      <th style="width: 10%" class="text-end">คงเหลือ</th>
                      <th style="width: 15%" class="text-end">ต้นทุน</th>
                      <th style="width: 15%" class="text-end">ราคาขาย</th>
                      <th style="width: 10%"></th>
                    </tr>
                  </thead>
                  <tbody id="stockTableBody">
                    </tbody>
                </table>
              </div>
              <div class="p-3 text-muted text-center d-none" id="stockTableEmpty">
                ไม่พบรายการอะไหล่ที่ตรงกับเงื่อนไขที่เลือก
              </div>
            </div>
          </section>
          <section
            class="bm-section"
            data-section="reports"
          >
            <h2 class="d-none">รายงาน / สถิติ</h2>
            <div class="alert alert-info">
              หน้ารายงาน/สถิติ: สำหรับแสดงผลสรุปยอดขาย, กำไร/ขาดทุน, และกราฟข้อมูลต่าง ๆ (จะถูกพัฒนาในภายหลัง)
            </div>
            
            <div class="row g-4">
              <div class="col-lg-6">
                <div class="bm-card">
                  <div class="bm-card-header"><div class="bm-card-title">สรุปยอดขาย (กราฟ)</div></div>
                  <div class="bm-card-body">
                    <p class="text-muted">ที่นี่จะเป็นพื้นที่สำหรับกราฟสรุปยอดขายรายวัน/รายเดือน</p>
                    <div style="height: 300px; background: #f8f9fa; border: 1px dashed #ddd;"></div>
                  </div>
                </div>
              </div>
              <div class="col-lg-6">
                <div class="bm-card">
                  <div class="bm-card-header"><div class="bm-card-title">รายงานกำไร/ขาดทุนจากรถซื้อ–ขาย</div></div>
                  <div class="bm-card-body">
                    <p class="text-muted">แสดงข้อมูลกำไร/ขาดทุนของรถที่ถูกขายแล้ว</p>
                    <ul class="list-group">
                      <li class="list-group-item d-flex justify-content-between align-items-center">
                        กำไรสุทธิจากรถขายแล้ว
                        <span class="badge text-bg-success rounded-pill">XX,XXX บาท</span>
                      </li>
                      <li class="list-group-item d-flex justify-content-between align-items-center">
                        รถที่กำลังค้างสต็อก (มูลค่ารวม)
                        <span class="badge text-bg-secondary rounded-pill">YY,YYY บาท</span>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </section>
          <section
            class="bm-section"
            data-section="settings"
          >
            <h2 class="d-none">ตั้งค่าร้านและระบบ</h2>
            <form id="settingsForm" class="row g-4">
              <div class="col-12 col-lg-6">
                <div class="bm-card">
                  <div class="bm-card-header"><div class="bm-card-title">ข้อมูลร้านค้าและใบเสร็จ</div></div>
                  <div class="bm-card-body">
                    <div class="mb-3">
                      <label class="form-label small">ชื่อร้าน</label>
                      <input type="text" class="form-control" id="settingShopName" required placeholder="เช่น BEN MOTOR" />
                    </div>
                    <div class="mb-3">
                      <label class="form-label small">เบอร์โทรศัพท์ร้าน</label>
                      <input type="tel" class="form-control" id="settingShopPhone" placeholder="เช่น 08X-XXXXXXX" />
                    </div>
                    <div class="mb-3">
                      <label class="form-label small">ที่อยู่ร้าน (บรรทัดที่ 1)</label>
                      <input type="text" class="form-control" id="settingShopAddressLine1" placeholder="เช่น 242/99 ถนนสายเอเชีย" />
                    </div>
                    <div class="mb-3">
                      <label class="form-label small">ข้อความท้ายใบเสร็จ (Footnote)</label>
                      <textarea
                        id="settingReceiptFooter"
                        class="form-control"
                        rows="2"
                        placeholder="เช่น ขอบคุณที่ใช้บริการ BEN MOTOR"
                      ></textarea>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="col-12 col-lg-6">
                <div class="bm-card">
                  <div class="bm-card-header"><div class="bm-card-title">การทำงานของระบบ</div></div>
                  <div class="bm-card-body">
                    <div class="mb-3">
                      <label class="form-label small d-block">Theme สี</label>
                      <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="settingsTheme" id="themeLight" value="light" checked />
                        <label class="form-check-label" for="themeLight">สว่าง (Light)</label>
                      </div>
                      <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="settingsTheme" id="themeDark" value="dark" />
                        <label class="form-check-label" for="themeDark">มืด (Dark)</label>
                      </div>
                      <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="settingsTheme" id="themeAuto" value="auto" />
                        <label class="form-check-label" for="themeAuto">อัตโนมัติ (ตามระบบ)</label>
                      </div>
                    </div>

                    <div class="mb-3">
                      <label class="form-label small d-block">ระบบล็อกอัตโนมัติ (Auto Lock)</label>
                      <div class="form-check form-switch mb-2">
                        <input class="form-check-input" type="checkbox" role="switch" id="autoLockEnabledCheckbox" />
                        <label class="form-check-label" for="autoLockEnabledCheckbox"
                          >เปิดใช้งานการล็อกหน้าจออัตโนมัติเมื่อไม่ได้ใช้งาน</label
                        >
                      </div>
                      <label class="form-label small">ช่วงเวลาที่ไม่ได้ใช้งาน (นาที)</label>
                      <input type="number" class="form-control" id="autoLockMinutesInput" value="5" min="1" max="60" />
                    </div>
                    
                    <div class="mb-3">
                      <label class="form-label small d-block">สำรองและส่งออกข้อมูล</label>
                      <p class="small text-muted mb-2">
                        ส่งออกข้อมูลงานซ่อม, สต็อก, รถซื้อ–ขาย ทั้งหมดเป็นไฟล์ JSON เพื่อสำรองข้อมูล
                      </p>
                      <button type="button" class="btn btn-outline-danger" id="exportDataBtn">
                        <i class="bi bi-file-earmark-code me-1"></i>ส่งออกข้อมูลทั้งหมด (.json)
                      </button>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="col-12 text-end">
                <button type="submit" class="btn btn-primary" id="settingsSaveBtn">
                  <i class="bi bi-save me-1"></i>บันทึกการตั้งค่า
                </button>
              </div>
            </form>
          </section>
          </main>
        <nav class="bm-bottom-nav d-md-none">
          <button
            type="button"
            class="bm-bottom-nav-btn active"
            data-section-target="dashboard"
          >
            <i class="bi bi-speedometer2"></i>
            <span>แดชบอร์ด</span>
          </button>
          <button
            type="button"
            class="bm-bottom-nav-btn"
            data-section-target="pos"
          >
            <i class="bi bi-journals"></i>
            <span>เปิดบิล</span>
          </button>
          <button
            type="button"
            class="bm-bottom-nav-btn"
            data-section-target="jobs"
          >
            <i class="bi bi-list-check"></i>
            <span>งานซ่อม</span>
          </button>
          <button
            type="button"
            class="bm-bottom-nav-btn"
            data-section-target="vehicles"
          >
            <i class="bi bi-motorbike"></i>
            <span>รถซื้อ–ขาย</span>
          </button>
          <button
            type="button"
            class="bm-bottom-nav-btn"
            data-section-target="stock"
          >
            <i class="bi bi-box-seam"></i>
            <span>สต็อก</span>
          </button>
          <button
            type="button"
            class="bm-bottom-nav-btn"
            data-section-target="reports"
          >
            <i class="bi bi-bar-chart"></i>
            <span>รายงาน</span>
          </button>
        </nav>
        </div>
    </div>

    <div
      class="modal fade"
      id="jobDetailModal"
      tabindex="-1"
      aria-labelledby="jobDetailModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="jobDetailModalLabel">รายละเอียดงานซ่อม</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body" id="jobDetailModalBody">
            <div class="row g-3">
              <div class="col-lg-6">
                <div class="bm-field-group">
                  <div class="bm-field-label">ข้อมูลลูกค้า</div>
                  <div class="fw-semibold" id="jobDetailCustomerName"></div>
                  <div class="text-muted small" id="jobDetailCustomerPhone"></div>
                </div>
              </div>
              <div class="col-lg-6">
                <div class="bm-field-group">
                  <div class="bm-field-label">ยานพาหนะ</div>
                  <div class="fw-semibold" id="jobDetailVehicleModel"></div>
                  <div class="text-muted small">
                    ทะเบียน: <span id="jobDetailVehiclePlate"></span> | ไมล์: <span id="jobDetailVehicleMileage"></span>
                  </div>
                </div>
              </div>
              <div class="col-lg-6">
                <div class="bm-field-group">
                  <div class="bm-field-label">สถานะงาน</div>
                  <div class="d-flex align-items-center">
                    <span class="text-muted">สถานะ:</span>
                    <span id="jobDetailStatusText" class="fw-semibold ms-2"></span>
                  </div>
                  <div class="text-muted small">
                    วันที่เปิดบิล: <span id="jobDetailDateCreated"></span>
                  </div>
                  <div class="text-muted small d-none" id="jobDetailDateDoneContainer">
                    วันที่ปิดบิล: <span id="jobDetailDateDone"></span>
                  </div>
                </div>
              </div>
              <div class="col-lg-6">
                <div class="bm-field-group">
                  <div class="bm-field-label">อาการที่แจ้ง/รายการซ่อม</div>
                  <div id="jobDetailDescription" class="small"></div>
                </div>
              </div>

              <div class="col-12">
                <div class="bm-card p-0">
                  <div class="bm-card-header"><div class="bm-card-title small">รายการค่าแรง/อะไหล่</div></div>
                  <div class="table-responsive">
                    <table class="table table-sm align-middle mb-0">
                      <thead>
                        <tr>
                          <th>ประเภท</th>
                          <th>รายละเอียด</th>
                          <th class="text-end">ราคา/หน่วย</th>
                          <th class="text-end">จำนวน</th>
                          <th class="text-end">รวม</th>
                        </tr>
                      </thead>
                      <tbody id="jobDetailItemsBody">
                        </tbody>
                      <tfoot>
                        <tr>
                          <td colspan="4" class="text-end fw-semibold">รวมสุทธิ:</td>
                          <td class="text-end fw-bold text-primary" id="jobDetailGrandTotal"></td>
                        </tr>
                      </tfoot>
                    </table>
                  </div>
                </div>
              </div>
            </div>
            
            <hr />
            <form id="jobDetailStatusForm">
              <div class="row g-3">
                <div class="col-lg-6">
                  <label class="form-label small">แก้ไขสถานะงาน</label>
                  <select id="jobDetailStatusSelect" class="form-select">
                    <option value="pending">รอการตรวจเช็ค</option>
                    <option value="in-progress">กำลังดำเนินการ/กำลังซ่อม</option>
                    <option value="awaiting-part">รออะไหล่</option>
                    <option value="ready">ซ่อมเสร็จ / พร้อมส่งมอบ</option>
                    <option value="done">ปิดบิลแล้ว</option>
                    <option value="canceled">ยกเลิก</option>
                  </select>
                </div>
                <div class="col-lg-6 d-flex align-items-end">
                  <button type="submit" class="btn btn-primary w-100" id="jobDetailSaveStatusBtn">
                    <i class="bi bi-arrow-right-circle me-1"></i>อัปเดตสถานะ
                  </button>
                </div>
              </div>
            </form>

          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ปิด</button>
            <button type="button" class="btn btn-outline-primary" id="jobDetailPrintBtn">
              <i class="bi bi-printer me-1"></i>พิมพ์ใบแจ้งหนี้
            </button>
          </div>
        </div>
      </div>
    </div>
    <div
      class="modal fade"
      id="vehicleBuyModal"
      tabindex="-1"
      aria-labelledby="vehicleBuyModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <form id="vehicleBuyForm">
            <div class="modal-header">
              <h5 class="modal-title" id="vehicleBuyModalLabel">รับซื้อรถเข้าระบบ (ค้างสต็อก)</h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body">
              <div class="mb-3">
                <label class="form-label small">รุ่นรถ / ยี่ห้อ</label>
                <input
                  type="text"
                  class="form-control"
                  id="vehicleBuyModel"
                  placeholder="เช่น Wave 110i"
                  required
                />
              </div>
              <div class="mb-3">
                <label class="form-label small">ทะเบียน</label>
                <input
                  type="text"
                  class="form-control"
                  id="vehicleBuyPlate"
                  placeholder="เช่น กข1234"
                  required
                />
              </div>
              <div class="mb-3">
                <label class="form-label small">สี</label>
                <input
                  type="text"
                  class="form-control"
                  id="vehicleBuyColor"
                  placeholder="เช่น แดง/ดำ"
                />
              </div>
              <div class="mb-3">
                <label class="form-label small">ราคาซื้อเข้า (บาท)</label>
                <input
                  type="number"
                  class="form-control text-end"
                  id="vehicleBuyPrice"
                  placeholder="0"
                  required
                  min="1"
                />
              </div>
              <div class="mb-3">
                <label class="form-label small">หมายเหตุ/รายละเอียด (เช่น สภาพ, ไมล์)</label>
                <textarea
                  class="form-control"
                  id="vehicleBuyNote"
                  rows="2"
                ></textarea>
              </div>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                ยกเลิก
              </button>
              <button type="submit" class="btn btn-primary" id="vehicleBuySaveBtn">
                <i class="bi bi-save me-1"></i>บันทึกการซื้อ
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
    <div
      class="modal fade"
      id="vehicleSellModal"
      tabindex="-1"
      aria-labelledby="vehicleSellModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <form id="vehicleSellForm">
            <div class="modal-header">
              <h5 class="modal-title" id="vehicleSellModalLabel">บันทึกการขายรถ</h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body">
              <div class="mb-3">
                <label class="form-label small">รุ่นรถ / ทะเบียน</label>
                <div class="fw-semibold" id="vehicleSellModelPlate"></div>
                <div class="small text-muted">ราคาซื้อเข้า: <span id="vehicleSellBuyPrice">0</span> บาท</div>
              </div>
              <div class="mb-3">
                <label class="form-label small">ค่าใช้จ่ายอื่น ๆ (รวมซ่อม/ตกแต่ง) (บาท)</label>
                <input
                  type="number"
                  class="form-control text-end"
                  id="vehicleSellExtraCost"
                  placeholder="0"
                  value="0"
                  min="0"
                />
              </div>
              <div class="mb-3">
                <label class="form-label small">ราคาขายออก (บาท)</label>
                <input
                  type="number"
                  class="form-control text-end"
                  id="vehicleSellPrice"
                  placeholder="0"
                  required
                  min="1"
                />
              </div>
              <div class="mb-4">
                <label class="form-label small">ชื่อผู้ซื้อ/ลูกค้า</label>
                <input
                  type="text"
                  class="form-control"
                  id="vehicleSellCustomer"
                  placeholder="ไม่ระบุ"
                />
              </div>
              <div class="d-flex justify-content-between fw-bold fs-5 border-top pt-2">
                <div>กำไร/ขาดทุน:</div>
                <div id="vehicleSellProfit" class="text-primary">0 บาท</div>
              </div>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                ยกเลิก
              </button>
              <button type="submit" class="btn btn-primary" id="vehicleSellSaveBtn">
                <i class="bi bi-save me-1"></i>บันทึกการขาย
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
    <div
      class="modal fade"
      id="stockEditModal"
      tabindex="-1"
      aria-labelledby="stockEditModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <form id="stockEditForm">
            <div class="modal-header">
              <h5 class="modal-title" id="stockEditModalLabel">เพิ่ม/แก้ไขอะไหล่ในสต็อก</h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body">
              <div class="mb-3">
                <label class="form-label small">ชื่ออะไหล่</label>
                <input
                  type="text"
                  class="form-control"
                  id="stockEditName"
                  placeholder="เช่น หัวเทียน, กรองอากาศ"
                  required
                />
              </div>
              <div class="row g-3">
                <div class="col-6">
                  <label class="form-label small">SKU / รหัสสินค้า</label>
                  <input
                    type="text"
                    class="form-control"
                    id="stockEditSKU"
                  />
                </div>
                <div class="col-6">
                  <label class="form-label small">หมวดหมู่</label>
                  <select id="stockEditCategory" class="form-select">
                    <option value="engine">เครื่องยนต์</option>
                    <option value="chassis">ตัวถัง/ช่วงล่าง</option>
                    <option value="electric">ไฟฟ้า</option>
                    <option value="chemical">เคมีภัณฑ์</option>
                    <option value="tool">เครื่องมือ</option>
                    <option value="other">อื่น ๆ</option>
                  </select>
                </div>
              </div>
              <div class="row g-3 mt-1">
                <div class="col-6">
                  <label class="form-label small">ราคาต้นทุน (บาท)</label>
                  <input
                    type="number"
                    class="form-control text-end"
                    id="stockEditCostPrice"
                    placeholder="0"
                    min="0"
                  />
                </div>
                <div class="col-6">
                  <label class="form-label small">ราคาขายออก (บาท)</label>
                  <input
                    type="number"
                    class="form-control text-end"
                    id="stockEditSalePrice"
                    placeholder="0"
                    required
                    min="1"
                  />
                </div>
              </div>
              <div class="row g-3 mt-1">
                <div class="col-6">
                  <label class="form-label small">จำนวนคงเหลือ (หน่วย)</label>
                  <input
                    type="number"
                    class="form-control text-end"
                    id="stockEditQuantity"
                    placeholder="0"
                    required
                    min="0"
                  />
                </div>
                <div class="col-6">
                  <label class="form-label small">จำนวนขั้นต่ำแจ้งเตือน (Min Stock)</label>
                  <input
                    type="number"
                    class="form-control text-end"
                    id="stockEditMinQuantity"
                    placeholder="0"
                    min="0"
                  />
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                ยกเลิก
              </button>
              <button type="submit" class="btn btn-primary" id="stockEditSaveBtn">
                <i class="bi bi-save me-1"></i>บันทึก
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
    <div
      class="modal fade"
      id="posCustomerMessageModal"
      tabindex="-1"
      aria-labelledby="posCustomerMessageModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="posCustomerMessageModalLabel">ข้อความสำหรับลูกค้า</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label class="form-label small">ข้อความ SMS/Line (คัดลอกได้)</label>
              <textarea
                class="form-control"
                id="posCustomerMessageTextarea"
                rows="5"
                readonly
              ></textarea>
            </div>
            <button class="btn btn-sm btn-outline-primary w-100" id="posCustomerMessageCopyBtn">
              <i class="bi bi-clipboard me-1"></i>คัดลอกข้อความ
            </button>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ปิด</button>
          </div>
        </div>
      </div>
    </div>
    <div
      class="toast-container position-fixed bottom-0 end-0 p-3"
      id="globalToastContainer"
    >
      </div>
    <div
      class="modal fade"
      id="autoLockModal"
      data-bs-backdrop="static"
      data-bs-keyboard="false"
      tabindex="-1"
      aria-labelledby="autoLockModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="autoLockModalLabel">ระบบล็อกอัตโนมัติ</h5>
          </div>
          <div class="modal-body text-center">
            <i class="bi bi-lock-fill text-primary fs-1 mb-3"></i>
            <p>หน้าจอถูกล็อกเนื่องจากไม่มีการใช้งานเป็นเวลานาน</p>
            <p>กรุณาเข้าสู่ระบบอีกครั้งเพื่อใช้งานต่อ</p>
          </div>
          <div class="modal-footer justify-content-center">
            <button type="button" class="btn btn-primary" id="autoLockLoginBtn">
              ไปที่หน้าเข้าสู่ระบบ
            </button>
          </div>
        </div>
      </div>
    </div>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>

    <script type="module" src="./js/firebase-init.js"></script>
    <script type="module" src="./js/utils.js"></script>
    <script type="module" src="./js/ui-shell.js"></script>
    <script type="module" src="./js/dashboard.js"></script>
    <script type="module" src="./js/pos.js"></script>
    <script type="module" src="./js/jobs.js"></script>
    <script type="module" src="./js/vehicles.js"></script>
    <script type="module" src="./js/stock.js"></script>
    <script type="module" src="./js/settings.js"></script>
    <script type="module" src="./js/reports.js"></script>
  </body>
</html>
